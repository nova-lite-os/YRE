<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gmail OAuth Login System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            width: 100%;
            max-width: 500px;
            position: relative;
        }

        .setup-instructions {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .setup-instructions h3 {
            color: #495057;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .setup-instructions ol {
            color: #6c757d;
            line-height: 1.6;
            padding-left: 1.2rem;
        }

        .setup-instructions li {
            margin-bottom: 0.8rem;
        }

        .setup-instructions code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-header h1 {
            color: #333;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .login-header p {
            color: #666;
            font-size: 1rem;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .gmail-login-btn {
            background: #dd4b39;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            position: relative;
        }

        .gmail-login-btn:hover {
            background: #c23321;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(221, 75, 57, 0.3);
        }

        .gmail-login-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .user-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            border: 3px solid #007bff;
        }

        .user-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .user-email {
            color: #666;
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .logout-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
        }

        .logout-btn:hover {
            background: #5a6268;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #ffffff;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .toggle-setup {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .toggle-setup:hover {
            background: #0056b3;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="toggle-setup" onclick="toggleSetupInstructions()">
            üìã Show/Hide Setup Instructions
        </button>

        <div id="setupInstructions" class="setup-instructions">
            <h3>üîß Google API Setup Instructions</h3>
            <ol>
                <li><strong>Go to Google Cloud Console:</strong> Visit <a href="https://console.cloud.google.com/" target="_blank">console.cloud.google.com</a></li>
                <li><strong>Create or Select Project:</strong> Create a new project or select an existing one</li>
                <li><strong>Enable Gmail API:</strong> Go to "APIs & Services" ‚Üí "Library" ‚Üí Search for "Gmail API" ‚Üí Enable it</li>
                <li><strong>Create OAuth Credentials:</strong>
                    <ul style="margin-top: 0.5rem; padding-left: 1rem;">
                        <li>Go to "APIs & Services" ‚Üí "Credentials"</li>
                        <li>Click "Create Credentials" ‚Üí "OAuth 2.0 Client IDs"</li>
                        <li>Select "Web application" as application type</li>
                        <li>Add your domain to "Authorized JavaScript origins"</li>
                    </ul>
                </li>
                <li><strong>Copy Client ID:</strong> Copy your Client ID and replace <code>YOUR_GOOGLE_CLIENT_ID</code> in the JavaScript below</li>
                <li><strong>Configure OAuth Consent Screen:</strong> Set up your OAuth consent screen with required information</li>
            </ol>
        </div>

        <div class="login-header">
            <h1>Gmail Login System</h1>
            <p>Secure authentication with your Google account</p>
        </div>

        <div id="errorMessage" class="error-message hidden">
            <span>‚ö†Ô∏è</span>
            <span id="errorText"></span>
        </div>

        <div id="successMessage" class="success-message hidden">
            <span>‚úÖ</span>
            <span id="successText"></span>
        </div>

        <div id="loginSection" class="login-form">
            <button id="loginBtn" class="gmail-login-btn" onclick="signIn()">
                <span id="loginBtnText">üìß Sign in with Gmail</span>
                <div id="loadingSpinner" class="loading-spinner hidden"></div>
            </button>
        </div>

        <div id="userSection" class="user-info hidden">
            <img id="userAvatar" class="user-avatar" src="" alt="User Avatar">
            <div id="userName" class="user-name"></div>
            <div id="userEmail" class="user-email"></div>
            <button class="logout-btn" onclick="signOut()">Sign Out</button>
        </div>
    </div>

    <!-- Google API -->
    <script src="https://apis.google.com/js/api.js"></script>

    <script>
        // Your Google OAuth Client ID
        const CLIENT_ID = '118044378838-a6vap5sh8g94d24v09if09vnpbppekt9.apps.googleusercontent.com';
        
        // Your API Key (for server-side API calls)
        const API_KEY = 'AIzaSyDa7vrd3Zseb989UdSmMVVl7vPwn6_95CA';
        
        // Configuration
        const DISCOVERY_DOCS = ['https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest'];
        const SCOPES = 'https://www.googleapis.com/auth/gmail.readonly profile email';

        let isSignedIn = false;
        let currentUser = null;

        // Initialize Google API with API Key
        function initializeGoogleAPI() {
            gapi.load('auth2', () => {
                gapi.auth2.init({
                    client_id: CLIENT_ID,
                    scope: SCOPES
                }).then(() => {
                    console.log('Google API initialized successfully');
                    
                    const authInstance = gapi.auth2.getAuthInstance();
                    isSignedIn = authInstance.isSignedIn.get();
                    
                    if (isSignedIn) {
                        currentUser = authInstance.currentUser.get();
                        handleSignInSuccess();
                    }
                    
                    // Listen for sign-in state changes
                    authInstance.isSignedIn.listen(updateSignInStatus);
                }).catch((error) => {
                    console.error('Error initializing Google API:', error);
                    showError('Failed to initialize Google API. Please obtain your OAuth Client ID from Google Cloud Console.');
                });
            });
        }

        // Handle sign-in
        async function signIn() {
            setLoading(true);
            clearMessages();

            try {
                const authInstance = gapi.auth2.getAuthInstance();
                currentUser = await authInstance.signIn();
                handleSignInSuccess();
            } catch (error) {
                console.error('Sign-in error:', error);
                if (error.error === 'access_denied') {
                    showError('Access denied. Make sure your email is added to the test users list in Google Cloud Console.');
                } else {
                    showError('Sign-in failed. Please try again.');
                }
            } finally {
                setLoading(false);
            }
        }

        // Handle sign-out
        function signOut() {
            const authInstance = gapi.auth2.getAuthInstance();
            authInstance.signOut().then(() => {
                currentUser = null;
                isSignedIn = false;
                updateUI();
                showSuccess('Successfully signed out');
            });
        }

        // Handle successful sign-in
        function handleSignInSuccess() {
            if (currentUser) {
                const profile = currentUser.getBasicProfile();
                const userInfo = {
                    id: profile.getId(),
                    name: profile.getName(),
                    email: profile.getEmail(),
                    imageUrl: profile.getImageUrl()
                };
                
                displayUserInfo(userInfo);
                showSuccess(`Welcome, ${userInfo.name}!`);
                
                // You can now make Gmail API calls
                loadGmailAPI();
            }
        }

        // Load Gmail API for additional functionality
        function loadGmailAPI() {
            gapi.load('client', () => {
                gapi.client.init({
                    apiKey: API_KEY,
                    discoveryDocs: DISCOVERY_DOCS
                }).then(() => {
                    console.log('Gmail API loaded successfully');
                    // Example: Get user's Gmail profile
                    getGmailProfile();
                }).catch((error) => {
                    console.error('Error loading Gmail API:', error);
                });
            });
        }

        // Example Gmail API call
        function getGmailProfile() {
            gapi.client.gmail.users.getProfile({
                userId: 'me'
            }).then((response) => {
                console.log('Gmail profile:', response.result);
                // You can use this data to display additional user information
            }).catch((error) => {
                console.error('Error getting Gmail profile:', error);
            });
        }

        // Update sign-in status
        function updateSignInStatus(signedIn) {
            isSignedIn = signedIn;
            if (signedIn) {
                const authInstance = gapi.auth2.getAuthInstance();
                currentUser = authInstance.currentUser.get();
                handleSignInSuccess();
            } else {
                currentUser = null;
                updateUI();
            }
        }

        // Display user information
        function displayUserInfo(userInfo) {
            document.getElementById('userAvatar').src = userInfo.imageUrl;
            document.getElementById('userName').textContent = userInfo.name;
            document.getElementById('userEmail').textContent = userInfo.email;
            updateUI();
        }

        // Update UI based on sign-in state
        function updateUI() {
            const loginSection = document.getElementById('loginSection');
            const userSection = document.getElementById('userSection');
            
            if (isSignedIn && currentUser) {
                loginSection.classList.add('hidden');
                userSection.classList.remove('hidden');
            } else {
                loginSection.classList.remove('hidden');
                userSection.classList.add('hidden');
            }
        }

        // Utility functions
        function setLoading(loading) {
            const loginBtn = document.getElementById('loginBtn');
            const loginBtnText = document.getElementById('loginBtnText');
            const loadingSpinner = document.getElementById('loadingSpinner');
            
            loginBtn.disabled = loading;
            
            if (loading) {
                loginBtnText.textContent = 'Signing in...';
                loadingSpinner.classList.remove('hidden');
            } else {
                loginBtnText.textContent = 'üìß Sign in with Gmail';
                loadingSpinner.classList.add('hidden');
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            errorText.textContent = message;
            errorDiv.classList.remove('hidden');
            
            // Hide success message if visible
            document.getElementById('successMessage').classList.add('hidden');
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            const successText = document.getElementById('successText');
            successText.textContent = message;
            successDiv.classList.remove('hidden');
            
            // Hide error message if visible
            document.getElementById('errorMessage').classList.add('hidden');
        }

        function clearMessages() {
            document.getElementById('errorMessage').classList.add('hidden');
            document.getElementById('successMessage').classList.add('hidden');
        }

        function toggleSetupInstructions() {
            const instructions = document.getElementById('setupInstructions');
            instructions.classList.toggle('hidden');
        }

        // Initialize when page loads
        window.onload = function() {
            initializeGoogleAPI();
        };
    </script>
</body>
</html>